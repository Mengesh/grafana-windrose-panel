define(["@grafana/data","react","@grafana/ui"],((e,t,l)=>(()=>{"use strict";var a={305:t=>{t.exports=e},388:e=>{e.exports=l},650:e=>{e.exports=t}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var l=n[e]={exports:{}};return a[e](l,l.exports,r),l.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{r.r(s),r.d(s,{plugin:()=>E});var e=r(305),t=r(650),l=r.n(t),a=r(388);const n=({children:e})=>l().createElement("g",null,e);function o(e,t,l,a,n){let r="",s=e-t/2,o=e+t/2;r+=Math.cos(s)*a+l.x+","+(Math.sin(s)*a+l.y)+" ",r+=Math.cos(s)*n+l.x+","+(Math.sin(s)*n+l.y)+" ";let i=Math.PI/180;for(let e=i;e<t;e+=i)r+=Math.cos(e+s)*n+l.x+","+(Math.sin(e+s)*n+l.y)+" ";let c=Math.cos(o)*a+l.x,u=Math.sin(o)*a+l.y;r+=Math.cos(o)*n+l.x+","+(Math.sin(o)*n+l.y)+" ",r+=c+","+u+" ";for(let e=i;e<t;e+=i)r+=Math.cos(o-e)*a+l.x+","+(Math.sin(o-e)*a+l.y)+" ";return r}function i(e,t,a,n,r){let s=a.x+Math.cos(e)*t*.1,o=a.x+Math.cos(e)*t,i=a.y+Math.sin(e)*t*.1,c=a.y+Math.sin(e)*t;return l().createElement("line",{x1:s,y1:i,x2:o,y2:c,strokeWidth:n?4:1,stroke:"#222222",strokeDasharray:r?"2,5":""})}function c(e,t,l){t((e=>{let t=[...e];return t[l].currentBucketStyle=t[l].selectedBucketStyle,t[l].currentStrokeStyle=t[l].highlightsStrokeStyle,t}))}function u(e,t,l){t((e=>{let t=[...e];return t[l].currentBucketStyle=t[l].idleBucketStyle,t[l].currentStrokeStyle=t[l].idleStrokeStyle,t}))}function d(e,t,l){t((e=>{let t=[...e];return t[l].currentBucketStyle=t[l].selectedBucketStyle,t[l].currentStrokeStyle=t[l].highlightsStrokeStyle,t}))}function h(e,t,l){t((e=>{let t=[...e];return t[l].currentBucketStyle=t[l].idleBucketStyle,t[l].currentStrokeStyle=t[l].idleStrokeStyle,t}))}const p=({data:e,width:t,height:r,center:s,radius:d,bucketsCount:h,styles:p,changeStyle:f,tooltipDecimalPlaces:y,directionLabels:m,directionLinesCount:k,windSpeedUnit:S})=>{let g=h,x=[],b=Math.PI/g/2;for(let e=0;e<2*g;e++){let t=b*e,l=0===e||e===g;x.push(i(t,d,s,l,!0)),x.push(i(t+Math.PI,d,s,l,!0))}let M=Math.PI/k/2,E=Math.PI/180;for(let e=0;e<2*k;e++){let t=M*e,l=0===e||e===k;x.push(i(t,d,s,l,!1)),x.push(i(t+Math.PI,d,s,l,!1))}y=Math.max(0,Math.round(y));let v=[],w=[],B=.9*d,P=.1*d,W=Math.PI/180;for(let t=0;t<e.petalBuckets.length;t++){let n=e.petalBuckets[t],r=(n.centerAngle+270)%360*W,i=P,d=0;n.speedBuckets.forEach(((e,t)=>{let h=i,m=i+B*e.petalRelativeSize;i=m;let k,g=o(r,b-E,s,h-.05,m+.05),x=p[e.index];k=t===n.speedBuckets.length-1?l().createElement("div",null,"Range: > ",d," ",S):l().createElement("div",null,"Range: ",d,"-",e.speedUpperBound," ",S);let M=l().createElement("div",null,l().createElement("div",null,"Size: ",l().createElement("b",null,Math.round(100*e.totalRelativeSize*Math.pow(10,y))/Math.pow(10,y)+"%")),k);d=e.speedUpperBound,v.push(l().createElement(a.Tooltip,{content:M},l().createElement("polygon",{className:e.index.toString(),onMouseEnter:t=>{c(0,f,e.index)},onMouseLeave:t=>{u(0,f,e.index)},points:g,fill:x.currentBucketStyle.color,fillOpacity:x.currentBucketStyle.opacity,stroke:x.bucketsStrokeStyle.stroke,strokeWidth:x.bucketsStrokeStyle.strokeWidth}))),w.push(l().createElement("polygon",{className:e.index.toString(),stroke:x.currentStrokeStyle.stroke,strokeWidth:x.currentStrokeStyle.strokeWidth,style:{pointerEvents:"none"},points:g,fill:"transparent"}))}))}let N=[];for(let e=0;e<m.length;e++){let t=m[e],a=(t.angle-90)*W,n=d+t.style.radiusOffset,r=s.x+Math.cos(a)*n,o=s.y+Math.sin(a)*n;N.push(l().createElement("text",{x:r,y:o,style:t.style.css,dominantBaseline:"middle",textAnchor:"middle"},t.text))}let L=function(e,t,l){let a=Math.PI/180,n=4*l,r=new Array(n).fill(0);t.forEach((e=>{r[e.index]=e.petalValuesCount}));let s=r[0]+r[r.length-1],o=0;for(let e=1;e<n;e++){let t=r[e-1],l=r[e];t+l<s&&(s=t+l,o=e)}return e*(o-1)+e/2-90*a}(b,e.petalBuckets,h),[z,O,R]=function(e,t,a,n){let r=[],s=.9*t/5;for(let e=0;e<5;e++){let n=t*(.1+.9*e/5);if(e>0&&r.push(l().createElement("circle",{cx:a.x,cy:a.y,r:n,strokeDasharray:"",fill:"transparent",stroke:"#222222",strokeWidth:".5"})),t>275)for(let o=1;o<5;o++)n=t*(.1+.9*e/5)+s*o/5,r.push(l().createElement("circle",{cx:a.x,cy:a.y,r:n,strokeDasharray:"5,5",fill:"transparent",stroke:"#222222",strokeWidth:".25"}))}let o=[],i=Math.sin(n),c=Math.cos(n),u=15*t/275,d=`normal ${Math.min(15,u)}px sans-serif`;for(let n=1;n<5;n++){let r=t*(n/5*.9+.1),s=a.x+c*r,u=a.y+i*r,h=e.maxPetalPercent/5*n*100;o.push(l().createElement("text",{x:s,y:u,style:{pointerEvents:"none",font:d},dominantBaseline:"auto",textAnchor:"start"},Math.round(10*h)/10+"%"))}return[r,[],o]}(e,d,s,L);return l().createElement("div",null,l().createElement("div",null,l().createElement("svg",{width:t,height:r},l().createElement(n,null,l().createElement("circle",{cx:s.x,cy:s.y,r:d,fill:"#f0f0f0"}),l().createElement("circle",{cx:s.x,cy:s.y,r:.1*d,fill:"#dddddd"}),l().createElement("circle",{cx:s.x,cy:s.y,r:d,fill:"transparent",stroke:"#222222",strokeWidth:"1"}),l().createElement("circle",{cx:s.x,cy:s.y,r:.1*d,fill:"transparent",stroke:"#222222",strokeWidth:"1"}),l().createElement(n,null,z),l().createElement(n,null,x),l().createElement(n,null,v),l().createElement(n,null,w),l().createElement(n,null,R),l().createElement(n,null,N),l().createElement(n,null,O)))))};function f(e,t,l){return e+(t-e)*l}function y(e){return Math.max(0,Math.min(255,e))}function m(e,t,l){return"#"+((1<<24)+(e<<16)+(t<<8)+l).toString(16).slice(1)}function k(e,t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)){return t?t.map((e=>parseInt(e,16))).slice(1):[0,0,0]}function S(e,t){let[l,a,n]=k(e),[r,s,o]=function(e,t,l){e/=255,t/=255,l/=255;let a,n=Math.max(e,t,l),r=Math.min(e,t,l),s=0,o=n,i=n-r;if(a=0===n?0:i/n,n===r)s=0;else{switch(n){case e:s=(t-l)/i+(t<l?6:0);break;case t:s=(l-e)/i+2;break;case l:s=(e-t)/i+4}s/=6}return[s,a,o]}(l,a,n);o=Math.max(0,Math.min(1,o*(1+t/2))),s=Math.max(0,Math.min(1,s*(1+t)));let[i,c,u]=function(e,t,l){let a=0,n=0,r=0,s=Math.floor(6*e),o=6*e-s,i=l*(1-t),c=l*(1-o*t),u=l*(1-(1-o)*t);switch(s%6){case 0:a=l,n=u,r=i;break;case 1:a=c,n=l,r=i;break;case 2:a=i,n=l,r=u;break;case 3:a=i,n=c,r=l;break;case 4:a=u,n=i,r=l;break;case 5:a=l,n=i,r=c}return[255*a,255*n,255*r]}(r,s,o);return m(y(Math.floor(i)),y(Math.floor(c)),y(Math.floor(u)))}function g(e,t,l){return[Math.floor(f(e[0],t[0],l)),Math.floor(f(e[1],t[1],l)),Math.floor(f(e[2],t[2],l))]}function x(e,t,l){let a=new Array(0);for(let l=1;l<=t;l++)a.push({index:l-1,speedUpperBound:e*l,totalRelativeSize:0,petalRelativeSize:0});l.forEach((l=>{let n=Math.min(t-1,Math.floor(l/e));a[n].petalRelativeSize++}));let n=new Array(0);return a.forEach((e=>{e.totalRelativeSize=e.petalRelativeSize,e.totalRelativeSize>0&&n.push(e)})),n}const b=({bucketsSize:e,bucketStyles:t,changeStyle:a,windSpeedUnit:n})=>{let r=[],s=0;for(let n=0;n<t.length;n++){let o=l().createElement("div",{style:{width:"20px",height:"10px",background:t[n].currentBucketStyle.color,opacity:t[n].currentBucketStyle.opacity,outline:t[n].currentStrokeStyle.strokeWidth+"px solid "+t[n].currentStrokeStyle.stroke,borderRadius:"4px",margin:"auto",marginRight:"6px",marginLeft:"0"},onMouseEnter:e=>{d(0,a,n)},onMouseLeave:e=>{h(0,a,n)}}),i=s+" - "+(s+e);t.length-1===n&&(i=" > "+s),s+=e,r.push(l().createElement("div",{style:{display:"flex"}},o," ",i))}return l().createElement("div",{style:{position:"absolute",bottom:"8px",right:"8px",width:"150px",border:"4px solid #4b4c50",borderRadius:"16px",padding:"8px",background:"#f2f2f2",color:"black"}},l().createElement("div",{style:{justifyContent:"center"}},l().createElement("b",null,"Wind speed (",n,")")),r)};function M(e,t){let l=function(e,t){let l=new Array(0);e.forEach((e=>{l.push(k(e))}));let a=new Array(0),n=e.length,r=1/(n-1);for(let e=0;e<t-1;e++){let s=e/(t-1),o=Math.floor(s/r),i=Math.min(o+1,n-1),c=s%r/r,u=g(l[o],l[i],c);a.push(m(u[0],u[1],u[2]))}return a.push(e[e.length-1]),a}(function(e){switch(e){case"operato":return["#1b1c20","#ffffff","#e6a749"];case"greenred":return["#4af244","#ecf238","#f23838"];case"bluered":return["#5e74ff","#d4d4d4","#ed3e3e"];case"grayscale":return["#bfbfbf","#3b3b3b"];case"redscale":return["#ff8f8f","#400000"];case"bluescale":return["#8fe5ff","#002b38"];default:return["#3844f2","#44f2a7","#ecf238","#f23838"]}}(e),t),a=Array(t);for(let e=0;e<a.length;e++){let t=S(l[e],-.5),n=S(l[e],.5),r={color:l[e],opacity:1},s={color:t,opacity:1},o={stroke:"transparent",strokeWidth:0};a[e]={idleBucketStyle:r,selectedBucketStyle:s,currentBucketStyle:r,bucketsStrokeStyle:{stroke:"black",strokeWidth:1},idleStrokeStyle:o,highlightsStrokeStyle:{stroke:n,strokeWidth:4},currentStrokeStyle:o}}return a}const E=new e.PanelPlugin((({options:e,data:a,width:n,height:r})=>{let[s,o]=(0,t.useState)(e.colorPalette),i=M(s,e.speedBucketsCount);const[c,u]=(0,t.useState)(i);(0,t.useEffect)((()=>{let t=M(e.colorPalette,e.speedBucketsCount);u(t)}),[e.colorPalette,e.speedBucketsCount]);let d=function(e,t,l,a){let n=4*t,r=-1/0,s=e.speed.length,o=new Array(n);for(let e=0;e<o.length;e++)o[e]=[];let i=360/n;for(let t=0;t<s;t++){let l=e.speed[t],a=e.direction[t];r=Math.max(r,a),o[Math.floor((a+i/2)%360/i)].push(l)}let c={petalBuckets:new Array(0),maxPetalPercent:0},u=0;for(let e=0;e<o.length;e++){if(0===o[e].length)continue;u=Math.max(u,o[e].length);let t=x(a,l,o[e]);c.petalBuckets.push({index:e,speedBuckets:t,centerAngle:i*e,petalValuesCount:o[e].length,containedDataRatio:o[e].length/s})}return c.petalBuckets.forEach((t=>{t.speedBuckets.forEach((t=>{t.petalRelativeSize/=u,t.totalRelativeSize/=e.speed.length}))})),c.maxPetalPercent=u/s,c}(function(e){let t=e.series[0],l=[],a=[];for(let e=0;e<t.fields[0].values.length;e++)for(let n=0;n<t.fields.length;n++){let r=t.fields[n];"wind_speed"===r.name&&l.push(r.values.get(e)),"wind_direction"===r.name&&a.push(r.values.get(e))}return{direction:a,speed:l}}(a),e.petalsPer90Deg,e.speedBucketsCount,e.speedBucketsSize),h=!e.doesLegendOverlay&&e.showLegend?150:0;const f=Math.min(r,n-h)/2-32,y={x:f+32,y:r/2};let m=[],k=Math.max(0,e.petalsPer90Deg);if("compass"===e.windroseLabels){const t={css:{font:"bold 20px sans-serif",fill:"white"},radiusOffset:16},l={css:{font:"normal 15px sans-serif",fill:"white"},radiusOffset:16},a={css:{font:"italic 10px sans-serif",fill:"white"},radiusOffset:16};m.push({angle:0,text:"N",style:t}),m.push({angle:90,text:"E",style:t}),m.push({angle:180,text:"S",style:t}),m.push({angle:270,text:"W",style:t}),k=1,"cardinal"!==e.cardinalLabels&&(m.push({angle:45,text:"NE",style:l}),m.push({angle:135,text:"SE",style:l}),m.push({angle:225,text:"SW",style:l}),m.push({angle:315,text:"NW",style:l}),k=2),"intermediate"===e.cardinalLabels&&(m.push({angle:22.5,text:"NNE",style:a}),m.push({angle:67.5,text:"ENE",style:a}),m.push({angle:112.5,text:"ESE",style:a}),m.push({angle:157.5,text:"SSE",style:a}),m.push({angle:202.5,text:"SSE",style:a}),m.push({angle:247.5,text:"WSW",style:a}),m.push({angle:292.5,text:"WNW",style:a}),m.push({angle:337.5,text:"NNW",style:a}),k=4)}else if("degree"===e.windroseLabels){const t={css:{font:"normal 12px sans-serif",fill:"white"},radiusOffset:16};let l=4*e.petalsPer90Deg,a=360/l;for(let e=0;e<l;e++){let l=a*e;m.push({angle:l,text:l+"°",style:t})}}let S=function(e){switch(e){case"ms":return"m/s";case"kmh":return"km/h";case"mps":return"mph";case"ftps":return"ft/s";case"kt":return"kt";default:return"N/A"}}(e.windSpeedUnit),g=l().createElement(b,{bucketsSize:e.speedBucketsSize,bucketStyles:c,changeStyle:u,windSpeedUnit:S});return l().createElement("div",null,l().createElement(p,{width:n,height:r,radius:f,center:y,data:d,bucketsCount:e.petalsPer90Deg,directionLabels:m,styles:c,changeStyle:u,tooltipDecimalPlaces:e.tooltipDecimalPlaces,directionLinesCount:k,windSpeedUnit:S}),e.showLegend&&g)})).setPanelOptions((e=>e.addSelect({path:"colorPalette",name:"Color palette",description:"Color palette of speed buckets.",defaultValue:"default",settings:{options:[{value:"default",label:"Default"},{value:"operato",label:"Operato theme"},{value:"greenred",label:"Green-red"},{value:"bluered",label:"Blue-red"},{value:"grayscale",label:"Gray scale"},{value:"redscale",label:"Red scale"},{value:"bluescale",label:"Blue scale"}]}}).addNumberInput({path:"petalsPer90Deg",name:"Petals per 90 degree",description:"How many petals should be per 90 degree. Total petals will be 4 times as many.",defaultValue:4}).addNumberInput({path:"speedBucketsCount",name:"Buckets per each petal.",description:"How many bucket should be per every direction bucket.",defaultValue:8}).addNumberInput({path:"speedBucketsSize",name:"Speed bucket size.",description:"Sets the size of each speed bucket (in m/s).",defaultValue:2}).addNumberInput({path:"tooltipDecimalPlaces",name:"Tooltip decimal places.",description:"How many decimal places should be displayed in tooltip.",defaultValue:1}).addSelect({path:"windSpeedUnit",name:"Wind speed unit",description:"What measurement unit will be used in legend and tooltip. !IMPORTANT! This will not convert values.",defaultValue:"ms",settings:{options:[{value:"ms",label:"Meters per second (m/s)"},{value:"kmh",label:"Kilometers per hour (km/h)"},{value:"mps",label:"Miles per hour (mph)"},{value:"ftps",label:"Feet per second (ft/s)"},{value:"kt",label:"Knots (kt)"}]}}).addSelect({path:"windroseLabels",name:"Windrose labels",defaultValue:"compass",settings:{options:[{value:"compass",label:"Compass directions"},{value:"degree",label:"Degrees of rotation"}]}}).addSelect({path:"cardinalLabels",name:"Cardinal labels",defaultValue:"cardinal",settings:{options:[{value:"cardinal",label:"Cardinal directions (N,E,S,W)"},{value:"ordinal",label:"Ordinal directions (NE, SE, SW, NW)"},{value:"intermediate",label:"Intermediate directions (WNW, NNW, NNE ...)"}]},showIf:e=>"compass"===e.windroseLabels}).addBooleanSwitch({path:"showLegend",name:"Show Legend",defaultValue:!0}).addBooleanSwitch({path:"doesLegendOverlay",name:"Does Legend Overlap",defaultValue:!1,showIf:e=>e.showLegend})))})(),s})()));
//# sourceMappingURL=module.js.map